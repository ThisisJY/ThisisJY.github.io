---
layout: single
title:  "ZEPETO/Unity(2): 월드 로직 작성(1)"
categories: Thoughts
tag: [ZEPETO, Unity]
toc: true 

---

## Server 정보
- World.multiplay (Zepeto Multiplay Server)



## DB 정보

- Schema (Zepeto Multiplay Schema Definition)



## 순서 1. Schemas 정의하기

Room State : Room의 현재 상태를 나타내는 Property. Schema 구조는 미리 정의되어 있다.

Schema Types : 서버 / 클라이언트 통신용 Data Structure이다. 이 데이터 구조로 클라이언트의 정보를 서버로 반대로 서버의 정보를 클라이언트에게로 뿌릴 수 있다.

멀티 환경에서 플레이어 간의 위치와 방향값을 저장하는 데이터 구조를 만들기 위해 먼저 Vector3로 필드값을 만들어주고, 이 Vector3로 Transform 구조를 정의한다. 다음으로 플레이어 정보 구조를 작성하는데, 플레이어의 작업을 식별하는 sessionID와 zepetoHash 필드를 문자열로 만들어주고, zepetoUserID는 플레이어 객체로 생성한다. 마지막으로 플레이어의 상태값을 저장하기 위해, state를 number로 정의한다.

Schemas 정의는 아래와 같이 한다.

![image-20220713220902138](/assets/img/image-20220713220902138.png)

![image-20220713223319097](../images/2022-07-11-f2/image-20220713223319097.png)







## 순서 2. Zepeto Multiplay Server가 제공하는 Room Lifecycle Event

1. onCreate ( options : SandboxOptions) : Room이 생성될 때 1회 호출 되며, Room에 대한 초기화 로직을 추가할 수 있다.
2. onJoin ( client : SandboxPlayer ) : Client가 Room에 입장할 때 호출된다. Client의 ID 및 캐릭터 정보는 SandboxPlayer 객체에 포함된다.
3. onLeaver ( client : SandboxPlayer, constend? : boolean) : Client가 Room에서 퇴장할 때 호출된다. 클라이언트가 연결 해제를 요청한 경우, Constented 값이 true로 호출되며 그렇지 않은 경우 false로 호출된다.
4. onTick ( deltaTime : number ) : SandboxOptions에서 설정된 tickInterval마다 반복적으로 호출되며, 각종 Interval 이벤트를 관리할 수 있다.



