---
layout: single
title:  "C#/.NET(27): Garbage Collector"
categories: Thoughts
tag: [C#, .NET]
toc: true 

---

## Garbage Collector 란?

Garbage Collector는 어플리케이션에 의해 사용되어지는 메모리를 관리하는 CLR의 Mechanism이다.

C언어의 경우 개발자가 메모리를 직접 할당하거나 할당을 해제할 책임이 있었다. 그러다보니 코드에 노이즈가 많고 오히려 에러가 발생할 경우가 많았다.

하지만, (적어도) C#에서는 이러한 걱정을 할필요가 없다.

어플리케이션이 실행되면 새로운 오브젝트를 생성하기 시작하고 생성된 오브젝트들은 메모리의 두 영역(stack, healp)에 각각 저장된다. 

C#의 자료형 타입에 대해서는 지난 번에도 다루었지만, 

메모리의 stack 영역은 변수 타입(int, bools, float, structs ...)이 저장된다. 이 메모리의 stack 영역에 저장된 값들은 스레드에서 실행 처리가 완료되는 즉시 메모리에서 사라진다. (아직 배움의 깊이가 깊지 않아 사라진다는 표현 정도밖에 못하겠다 ㅎㅎ)

```c#
using System;

namespace GarbageCollector
{
	internal class Program
	{
		static void Main(string[] args)
		{
			var a = new int();
			int b = 0;

			if (args != null)
			{
				a = 5;
				b = 5;
				// 변수 a, b가 처리되는 즉시 메모리에서 사라짐
			}
			
			Console.WriteLine($"{a} / {a.GetType()}");
			Console.WriteLine($"{b} / {b.GetType()}");

		}
	}
}
```



그런데, Garbage Collecotr는 value type을 관리하지 않는다.

Garbage Collector는 heap 영역의 오브젝트를 관리하는데, 그래서 관리 대상은 참조 타입(strings, Lists, arrays, class에 의해 정의된 오브젝트들)이다.

```c#
using System;

namespace GarbageCollector
{
	internal class Program
	{
		public class Person
		{
			public string Name;
			public string Country;
			public BirthDay Birth;

			public Person(string name, string country, BirthDay birth)
			{
				Name = name;
				Country = country;
				Birth = birth;
			}
		}


		static void Main(string[] args)
		{
			//var a = new int();
			//int b = 0;

			//if (args != null)
			//{
			//	a = 5;
			//	b = 5;
			//	// 변수 a, b가 처리되는 즉시 메모리에서 사라짐
			//}

			//Console.WriteLine($"{a} / {a.GetType()}");
			//Console.WriteLine($"{b} / {b.GetType()}");

			var Man = new Person("이동규", "대한민국", new BirthDay(1987, 10, 16));

			if (args != null)
			{
				Man.Name = "John";
				Man.Country = "USA";
				Man.Birth = new BirthDay(1911, 5, 5);
			}

			Console.WriteLine($"His name : {Man.Name}");
			Console.WriteLine($"His country : {Man.Country}");
			Console.WriteLine($"His Birthday : {Man.Birth.Year} / {Man.Birth.Month} / {Man.Birth.Day}");
			// class에 의해 정의된 Man이 처리되면 Garbage Collector에 의해 메모리에서 사라짐 
		}
	}
}
```







## 그렇다면 Garbage Collector는 언제 메모리를 청소할까?

위에서 살펴본 바와 같이 Garbage Collector는 heap의 오브젝트를 메모리에서 바로 처리하지 않는다.

아래 케이스를 만족했을 때, 그 역할을 수행하게 된다.

- 물리적으로 사용할 수 있는 메모리의 양이 적을 때 (OS에서 알리게 됨)
- 힙에 할당된 객체가 사용하는 메모리의 양이 임계치를 초과했을 때, 이 임계치를 지속적으로 조절해야만 할 떄
- G.C 메소드가 콜이 되었을 떄





